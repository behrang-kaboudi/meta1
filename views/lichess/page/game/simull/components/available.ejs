<div class="wg-box overflow-auto dir-ltr">
    <div class="wg-title h5">
        UpComing Simuls
    </div>
    <div class="wg-inner">
        <div id="availableSimulls">

        </div>
    </div>
</div>
<script>
    var availableSimulls = {
        getAvailable: () => {
            socket.emit('availableSimulls', {}, availableSimulls.set)
        },
        redirctNewGame: (games) => {
            if (!games || games.length == 0) return;
            for (let i = 0; i < games.length; i++) {
                const gm = games[i];
                console.log('', gm);
                if (gm.blackResult === null) {
                    if (gm.acceptedTime - Date.now() > 30000) return;
                    window.location.href = window.location.origin + '/game/play/' + gm._id;
                }
            }
        },
        join: (id) => {
            socket.emit('joinSimull', {
                id
            })
        },
        withdraw: (id) => {
            socket.emit('withdrawSimull', {
                id
            })
        },
        start: (id) => {
            socket.emit('startSimull', {
                id
            })
        },
        set: (simulls) => {
            let html = '';
            for (let i = 0; i < simulls.length; i++) {
                const sim = simulls[i];
                let joinBtn = `<button class="btn btn-primary" onclick="availableSimulls.join('${sim._id}')"> Join </button>`;
                let withdraw = `<button class="btn btn-danger" onclick="availableSimulls.withdraw('${sim._id}')"> Withdraw </button>`;
                // let start = `<button class="btn btn-success" onclick="availableSimulls.start('${sim._id}')"> Start </button>`;
                let waiting = `<button class="btn btn-success" > Waiting </button>`;
                let btn = joinBtn;
                if (sim.players.includes(userName)) btn = withdraw;
                // if (sim.creatorUserName == userName) {
                //     if (sim.players.length > 0) {
                //         btn = start;
                //     } else {
                //         btn = waiting;
                //     }

                // }

                html += `<div class='d-flex p-3'>
                        <div class='text-primary'  style='width:45%'>
                            <div>
                                <a class='fs-3'>
                                    ${sim.name}  simul
                                </a>
                            </div>
                           
                            <div>
                                ${sim.clockTime / 60} + ${sim.clockIncrement}s
                            </div>
                            
                        </div>
                        <div  style='width:25%'>
                             ${sim.creatorUserName}
                        </div>
                        <div  style='width:10%'>
                           <i class="fas fa-user"></i> ${sim.players.length}
                        </div>
                        <div class='text-center'  style='width:10%'>
                            ${btn}
                        </div>
                    </div>
                    `;
            }
            document.getElementById('availableSimulls').innerHTML = html;

        }
    };
    $(document).ready(() => {
        availableSimulls.getAvailable();
        socket.on('updateAvailableSimulls', function () {
            availableSimulls.getAvailable()
        })
    })
</script>