<style>
    #homePageLobby {
        height: 37vw;
    }

    @media (max-width: 768px) {
        #homePageLobby {
            height: 76vw
        }
    }

    @media (min-width: 768px) {}
</style>
<div id="homePageLobby" class="row timeSets-main-part mx-0 px-0 d-none bg-light" style="">
    <div class="homePageLobby">
        <table class="table table-striped table-hover" style="height: auto;">
            <thead>
                <tr>
                    <th scope="col" style="width: 5%;">#</th>
                    <th scope="col" style="width: 35%;">
                        <%- user.trans('Player') %>
                    </th>
                    <th scope="col">
                        <%- user.trans('Rating') %>
                    </th>
                    <th scope="col">
                        <%- user.trans('Time') %>
                    </th>
                    <th scope="col">
                        <%- user.trans('Mode') %>
                    </th>
                </tr>
            </thead>
            <style>
                .lobby-innerTbl-tr,
                .lobby-innerTbl-tr td {
                    height: 12px !important;
                }
            </style>
            <tbody id="lobby-innerTbl">

            </tbody>
        </table>
    </div>

</div>
<script>
    let lobby = {
        controls: {
            tblBody: document.getElementById('lobby-innerTbl')
        },
        getChalenges: function () {
            // socket.emit('getOpenChalenges')
            socket.emit('chalenge', { signal: 'opens' })
        },
        setOpenChalengs: function (chalengs) {
            lobby.controls.tblBody.innerHTML = '';
            let allRows = '';
            for (let i = 0; i < chalengs.length; i++) {
                const ch = chalengs[i];
                let mode = ch.rated ? 'Rated' : 'Casual';
                let rating = timeControllLogo.gameTimeControll(ch);
                rating = ch.requesterUser[rating];
                let tr = document.createElement('tr');
                tr.addEventListener('click', function () {
                    if (!userName) return;
                    socket.emit('chalenge', { signal: 'accept', id: ch._id }, function (game) {
                        if (!game) return;
                        window.location.href = "/game/play/" + game._id;
                    })
                });
                tr.classList.add('pointer', 'lobby-innerTbl-tr');
                // tr.style.text = '34px !important';
                let seconds = "";
                if (Number(ch.gameTimeSecs) > 0) {
                    seconds = ':' + ch.gameTimeSecs;
                }
                let trInner = `
                    <th scope="row">${i + 1}</th>
                    <td>${ch.requsterUserName}</td>
                    <td>${rating}</td>
                    <td>${ch.gameTimeMins + seconds + ' + ' + ch.timeIncresment
                    }</td >
                <td>${mode}</td>
                `;
                tr.innerHTML = trInner;
                lobby.controls.tblBody.append(tr);
            }

        }
    }
    $(document).ready(function () {
        // lobby.getChalenges();
        socket.on('openChalengs', lobby.setOpenChalengs);
        socket.io.on('reconnect', function () {
            lobby.getChalenges();
        });
        // socket.on('connect', function () {

        // });
        socket.on('openChalengsUpdate', function () {
            lobby.getChalenges();
        });
        lobby.getChalenges();
    })
</script>